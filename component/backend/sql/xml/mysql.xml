<?xml version="1.0" encoding="UTF-8"?>
<schema>
	<!-- Metadata -->
	<meta>
		<!-- Supported driver types -->
		<drivers>
			<driver>mysql</driver>
			<driver>mysqli</driver>
			<driver>pdomysql</driver>
		</drivers>
	</meta>

	<!-- SQL commands to run on installation and update -->
	<sql>
		<!-- User data export audit trail -->
		<action table="#__datacompliance_exporttrails" canfail="0">
			<condition type="missing" value="" />
			<query><![CDATA[
CREATE TABLE `#__datacompliance_exporttrails` (
`datacompliance_exporttrail_id` bigint(20) NOT NULL AUTO_INCREMENT,
`user_id` bigint(20) unsigned NOT NULL,
`created_on` datetime NOT NULL,
`created_by` bigint(20) NOT NULL,
`requester_ip` varchar(255) NOT NULL,
PRIMARY KEY (`datacompliance_exporttrail_id`),
KEY `#__datacompliance_exporttrail_user` (`user_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
		</action>

		<!-- User data wiping audit trail -->
		<action table="#__datacompliance_wipetrails" canfail="0">
			<condition type="missing" value="" />
			<query><![CDATA[
CREATE TABLE `#__datacompliance_wipetrails` (
`datacompliance_wipetrail_id` BIGINT(20) NOT NULL AUTO_INCREMENT,
`user_id` bigint(20) NOT NULL,
`type` enum('lifecycle','user','admin') NOT NULL DEFAULT 'user',
`created_on` datetime NOT NULL,
`created_by` bigint(20) NOT NULL,
`requester_ip` varchar(255) NOT NULL,
`items` longtext,
PRIMARY KEY (`datacompliance_wipetrail_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
		</action>

		<!-- Processing consent audit trail -->
		<action table="#__datacompliance_consenttrails" canfail="0">
			<condition type="missing" value="" />
			<query><![CDATA[
CREATE TABLE `#__datacompliance_consenttrails` (
`created_on` datetime NOT NULL,
`created_by` bigint(20) NOT NULL,
`requester_ip` varchar(255) NOT NULL,
`enabled` int(1) NOT NULL DEFAULT 0,
PRIMARY KEY (`created_by`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
		</action>

		<!-- User profile changes audit trail -->
		<action table="#__datacompliance_usertrails" canfail="0">
			<condition type="missing" value="" />
			<query><![CDATA[
CREATE TABLE `#__datacompliance_usertrails` (
`datacompliance_usertrail_id` BIGINT(20) NOT NULL AUTO_INCREMENT,
`user_id` bigint(20) NOT NULL,
`created_on` datetime NOT NULL,
`created_by` bigint(20) NOT NULL,
`requester_ip` varchar(255) NOT NULL,
`items` longtext,
PRIMARY KEY (`datacompliance_usertrail_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
		</action>

		<action table="#__datacompliance_emailtemplates" canfail="0">
			<condition type="missing" value="" />
			<query><![CDATA[
CREATE TABLE `#__datacompliance_emailtemplates` (
    `datacompliance_emailtemplate_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
    `key` enum('user_user', 'user_admin', 'user_lifecycle', 'admin_user', 'admin_admin', 'admin_lifecycle') NOT NULL DEFAULT 'user_user',
    `subject` varchar(255) NOT NULL DEFAULT '',
    `body` text,
    `language` varchar(10) NOT NULL DEFAULT '*',
    `enabled` tinyint(4) NOT NULL DEFAULT '1',
    `ordering` bigint(20) NOT NULL DEFAULT '0',
    `created_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `created_by` bigint(20) NOT NULL DEFAULT '0',
    `modified_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `modified_by` bigint(20) NOT NULL DEFAULT '0',
    `locked_on` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
    `locked_by` bigint(20) NOT NULL DEFAULT '0',
    PRIMARY KEY (`datacompliance_emailtemplate_id`)
) DEFAULT COLLATE utf8_general_ci;
            ]]></query>
		</action>

		<action table="#__akeebasubs_emailtemplates" canfail="1">
		<condition type="equals" operator="not" value="1"><![CDATA[
SELECT COUNT(*) FROM `#__datacompliance_emailtemplates` WHERE `datacompliance_emailtemplate_id` = 1;
            ]]></condition>
		<query>
		</query>
		</action>
	</sql>
</schema>
